# Discovery Engine LinkML Schema
# This schema defines the data models for remote facility discovery.
# Generated Pydantic models should NOT be edited directly.

id: https://iter.org/imas-codex/discovery
name: discovery
title: IMAS Codex Discovery Schema
description: >-
  Schema for the Discovery Engine that surveys remote fusion facilities
  and catalogs their filesystem structure, available tools, and data assets.

prefixes:
  linkml: https://w3id.org/linkml/
  discovery: https://iter.org/imas-codex/discovery/

default_prefix: discovery
default_range: string

imports:
  - linkml:types

classes:
  RemoteEnvironment:
    description: >-
      Snapshot of a remote facility's capabilities and available tools.
      Produced by the environment probe during initial facility discovery.
    attributes:
      host:
        description: SSH host alias or hostname for the remote facility
        range: string
        required: true
      probe_timestamp:
        description: When the environment was probed
        range: datetime
      available_tools:
        description: Tools discovered on the remote system
        range: ToolInfo
        multivalued: true
        inlined_as_list: true
      python_version:
        description: Python version available on remote system
        range: string
      shell:
        description: Default shell on remote system
        range: string
      os_info:
        description: Operating system information
        range: string
      data_libraries:
        description: Data access libraries available (MDSplus, HDF5, etc.)
        range: string
        multivalued: true

  ToolInfo:
    description: >-
      Information about a discovered command-line tool on the remote system.
    attributes:
      name:
        description: Tool name (e.g., rg, find, tree-sitter)
        range: string
        required: true
      path:
        description: Absolute path to the tool binary
        range: string
      version:
        description: Tool version string if available
        range: string
      available:
        description: Whether the tool is available and executable
        range: boolean
        required: true

  FilesystemNode:
    description: >-
      A node in the filesystem tree. Can represent files, directories, or symlinks.
      Forms a recursive tree structure via the children attribute.
    attributes:
      path:
        description: Absolute path to this node
        range: string
        required: true
      name:
        description: Basename of the path
        range: string
      node_type:
        description: Type of filesystem node
        range: NodeType
        required: true
      size:
        description: Size in bytes (for files)
        range: integer
      modified:
        description: Last modification timestamp
        range: datetime
      permissions:
        description: Unix permission string (e.g., rwxr-xr-x)
        range: string
      children:
        description: Child nodes (for directories)
        range: FilesystemNode
        multivalued: true
        inlined_as_list: true
      symlink_target:
        description: Target path for symlinks
        range: string

  SurveyResult:
    description: >-
      Complete output of a Surveyor scan of a remote facility.
      Contains the filesystem tree and scan metadata.
    attributes:
      facility:
        description: Facility identifier (e.g., epfl, jet, iter)
        range: string
        required: true
      scan_timestamp:
        description: When the scan was performed
        range: datetime
        required: true
      root_paths:
        description: Root paths that were scanned
        range: string
        multivalued: true
      tree:
        description: Root of the filesystem tree
        range: FilesystemNode
        inlined: true
      statistics:
        description: Scan statistics
        range: ScanStatistics
        inlined: true
      environment:
        description: Remote environment snapshot
        range: RemoteEnvironment
        inlined: true

  ScanStatistics:
    description: Statistics about a filesystem scan
    attributes:
      total_files:
        description: Total number of files discovered
        range: integer
      total_directories:
        description: Total number of directories discovered
        range: integer
      total_symlinks:
        description: Total number of symlinks discovered
        range: integer
      total_size_bytes:
        description: Total size of all files in bytes
        range: integer
      scan_duration_seconds:
        description: How long the scan took
        range: float
      excluded_paths:
        description: Number of paths excluded by filters
        range: integer

  FacilityConfig:
    description: >-
      Configuration for surveying a specific facility.
      Stored in config/{facility}.yaml files.
    attributes:
      name:
        description: Facility name
        range: string
        required: true
      ssh_host:
        description: SSH host alias from ~/.ssh/config
        range: string
        required: true
      scan_roots:
        description: Root directories to scan
        range: string
        multivalued: true
      exclude_patterns:
        description: Glob patterns for paths to exclude
        range: string
        multivalued: true
      include_patterns:
        description: Glob patterns for paths to include (overrides excludes)
        range: string
        multivalued: true
      max_file_size:
        description: Maximum file size to analyze in bytes
        range: integer
      max_depth:
        description: Maximum directory depth to traverse
        range: integer
      timeout_seconds:
        description: Command timeout in seconds
        range: integer

enums:
  NodeType:
    description: Types of filesystem nodes
    permissible_values:
      file:
        description: Regular file
      directory:
        description: Directory
      symlink:
        description: Symbolic link
      other:
        description: Other node types (sockets, devices, etc.)


